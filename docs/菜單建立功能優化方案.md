# èœå–®å»ºç«‹åŠŸèƒ½å„ªåŒ–æ–¹æ¡ˆ

## ğŸ“‹ å•é¡Œåˆ†æ

### ç¾æ³å•é¡Œ
æ ¹æ“š GitHub Issue #1 çš„å›å ±ï¼Œç›®å‰èœå–®å»ºç«‹åŠŸèƒ½å­˜åœ¨ä»¥ä¸‹å•é¡Œï¼š

1. **ç‰ˆæœ¬è™Ÿå•é¡Œ**
   - ä½¿ç”¨è€…ä¸çŸ¥é“è¦å¡«å¤šå°‘æ‰æ˜¯å°çš„
   - å¸Œæœ›å¯ä»¥è‡ªå‹•ç–ŠåŠ ç‰ˆæœ¬è™Ÿ

2. **è¡¨å–®ä»‹é¢å•é¡Œ**
   - åªæœ‰ç‰ˆæœ¬è™Ÿèˆ‡æè¿°å…©å€‹æ¬„ä½
   - ä¸çŸ¥é“è¦è¼¸å…¥ä»€éº¼æ‰èƒ½æ­£ç¢ºå»ºç«‹èœå–®
   - ç¼ºä¹ç›´è§€çš„ä»‹é¢
   - æ²’æœ‰é˜²å‘†åŠŸèƒ½

### ç¾æœ‰æ¶æ§‹åˆ†æ

#### å¾Œç«¯æ¶æ§‹
- **è³‡æ–™æ¨¡å‹**: `Menu` æ¨¡å‹åŒ…å« `Id`, `Version`, `MenuData`, `LastUpdated`
- **API ç«¯é»**: `POST /api/v1/menu` ç”¨æ–¼æ›´æ–°èœå–®
- **ç‰ˆæœ¬ç®¡ç†**: è‡ªå‹•è¨ˆç®— `currentVersion + 1`
- **è³‡æ–™æ ¼å¼**: `MenuData` ç‚º JSON å­—ä¸²ï¼ŒåŒ…å« `categories` é™£åˆ—

#### å‰ç«¯æ¶æ§‹
- **è¡¨å–®æ¬„ä½**: åƒ…æœ‰ `version` (InputNumber) å’Œ `description` (TextArea)
- **è³‡æ–™çµæ§‹**: ä½¿ç”¨ `Menu`, `MenuCategory`, `MenuItem` ä»‹é¢
- **æ¬Šé™æ§åˆ¶**: åƒ… Admin å¯å»ºç«‹èœå–®

## ğŸ¯ è§£æ±ºæ–¹æ¡ˆè¨­è¨ˆ

### 1. ç‰ˆæœ¬è™Ÿè‡ªå‹•åŒ–
- **è‡ªå‹•è¨ˆç®—**: å‰ç«¯è‡ªå‹•å–å¾—æœ€æ–°ç‰ˆæœ¬è™Ÿä¸¦ +1
- **é¡¯ç¤ºæç¤º**: é¡¯ç¤ºç•¶å‰ç‰ˆæœ¬èˆ‡æ–°ç‰ˆæœ¬è³‡è¨Š
- **é˜²é‡è¤‡**: é˜²æ­¢åŒæ™‚å»ºç«‹å¤šå€‹ç‰ˆæœ¬

### 2. è¡¨å–®ä»‹é¢å„ªåŒ–
- **åˆ†é¡ç®¡ç†**: å¯æ–°å¢/ç·¨è¼¯/åˆªé™¤åˆ†é¡
- **é …ç›®ç®¡ç†**: æ¯å€‹åˆ†é¡ä¸‹å¯æ–°å¢/ç·¨è¼¯/åˆªé™¤é …ç›®
- **å³æ™‚é©—è­‰**: è¡¨å–®é©—è­‰èˆ‡éŒ¯èª¤æç¤º
- **é è¦½åŠŸèƒ½**: å³æ™‚é è¦½èœå–®çµæ§‹

### 3. é˜²å‘†æ©Ÿåˆ¶
- **å¿…å¡«é©—è­‰**: åˆ†é¡åç¨±ã€é …ç›®åç¨±ã€åƒ¹æ ¼ç­‰å¿…å¡«
- **æ ¼å¼é©—è­‰**: SKU æ ¼å¼ã€åƒ¹æ ¼ç¯„åœç­‰
- **é‡è¤‡æª¢æŸ¥**: é˜²æ­¢ SKU é‡è¤‡
- **ç¢ºèªæ©Ÿåˆ¶**: é‡è¦æ“ä½œå‰çš„ç¢ºèªå°è©±æ¡†

## ğŸ—ï¸ æŠ€è¡“è¨­è¨ˆ

### å‰ç«¯çµ„ä»¶æ¶æ§‹

```
MenuPage/
â”œâ”€â”€ MenuForm/
â”‚   â”œâ”€â”€ MenuBasicInfo/          # åŸºæœ¬è³‡è¨Šï¼ˆç‰ˆæœ¬ã€æè¿°ï¼‰
â”‚   â”œâ”€â”€ CategoryList/           # åˆ†é¡åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ CategoryItem/       # å–®å€‹åˆ†é¡
â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryHeader/ # åˆ†é¡æ¨™é¡Œ
â”‚   â”‚   â”‚   â””â”€â”€ ItemList/       # é …ç›®åˆ—è¡¨
â”‚   â”‚   â”‚       â””â”€â”€ ItemForm/   # é …ç›®è¡¨å–®
â”‚   â”‚   â””â”€â”€ AddCategory/        # æ–°å¢åˆ†é¡
â”‚   â””â”€â”€ MenuPreview/            # èœå–®é è¦½
â””â”€â”€ MenuList/                   # èœå–®åˆ—è¡¨
```

### è³‡æ–™çµæ§‹è¨­è¨ˆ

```typescript
// èœå–®å»ºç«‹è«‹æ±‚
interface CreateMenuRequest {
  version: number;           // è‡ªå‹•è¨ˆç®—
  description?: string;      // å¯é¸æè¿°
  categories: MenuCategory[]; // åˆ†é¡é™£åˆ—
}

// åˆ†é¡çµæ§‹
interface MenuCategory {
  name: string;              // åˆ†é¡åç¨±
  items: MenuItem[];         // é …ç›®é™£åˆ—
}

// é …ç›®çµæ§‹
interface MenuItem {
  sku: string;               // SKU ç·¨è™Ÿ
  name: string;              // é …ç›®åç¨±
  price: number;             // åƒ¹æ ¼
}
```

### API è¨­è¨ˆ

#### 1. å–å¾—æœ€æ–°ç‰ˆæœ¬è™Ÿ
```http
GET /api/v1/menu/latest-version
Authorization: Bearer <token>

Response:
{
  "version": 5,
  "lastUpdated": "2024-12-01T10:00:00Z"
}
```

#### 2. å»ºç«‹èœå–®ï¼ˆæ›´æ–°ç¾æœ‰ï¼‰
```http
POST /api/v1/menu
Authorization: Bearer <admin_token>
Content-Type: application/json

Request:
{
  "version": 6,
  "description": "2024å¹´12æœˆæ›´æ–°èœå–®",
  "categories": [
    {
      "name": "é£²æ–™",
      "items": [
        {
          "sku": "DRINK001",
          "name": "å¯æ¨‚",
          "price": 30
        }
      ]
    }
  ]
}
```

## ğŸ“ å¯¦ä½œè¨ˆç•«

### Phase 1: å¾Œç«¯ API å„ªåŒ–
1. **æ–°å¢å–å¾—æœ€æ–°ç‰ˆæœ¬è™Ÿ API**
   - å»ºç«‹ `GET /api/v1/menu/latest-version` ç«¯é»
   - è¿”å›æœ€æ–°ç‰ˆæœ¬è™Ÿèˆ‡æ›´æ–°æ™‚é–“

2. **å„ªåŒ–èœå–®å»ºç«‹ API**
   - å¢å¼·è¼¸å…¥é©—è­‰
   - æ”¹å–„éŒ¯èª¤è¨Šæ¯
   - æ–°å¢ SKU é‡è¤‡æª¢æŸ¥

### Phase 2: å‰ç«¯è¡¨å–®é‡æ§‹
1. **å»ºç«‹æ–°çš„èœå–®è¡¨å–®çµ„ä»¶**
   - `MenuForm` ä¸»çµ„ä»¶
   - `CategoryList` åˆ†é¡ç®¡ç†
   - `ItemForm` é …ç›®è¡¨å–®

2. **å¯¦ä½œå‹•æ…‹è¡¨å–®åŠŸèƒ½**
   - æ–°å¢/åˆªé™¤åˆ†é¡
   - æ–°å¢/åˆªé™¤é …ç›®
   - å³æ™‚é©—è­‰

### Phase 3: ä½¿ç”¨è€…é«”é©—å„ªåŒ–
1. **ç‰ˆæœ¬è™Ÿè‡ªå‹•åŒ–**
   - è‡ªå‹•å–å¾—æœ€æ–°ç‰ˆæœ¬
   - é¡¯ç¤ºç‰ˆæœ¬è³‡è¨Š
   - é˜²æ­¢é‡è¤‡æäº¤

2. **é˜²å‘†æ©Ÿåˆ¶**
   - è¡¨å–®é©—è­‰
   - ç¢ºèªå°è©±æ¡†
   - éŒ¯èª¤æç¤º

### Phase 4: é è¦½èˆ‡æ¸¬è©¦
1. **èœå–®é è¦½åŠŸèƒ½**
   - å³æ™‚é è¦½èœå–®çµæ§‹
   - æ¨¡æ“¬å¯¦éš›é¡¯ç¤ºæ•ˆæœ

2. **æ¸¬è©¦èˆ‡é™¤éŒ¯**
   - åŠŸèƒ½æ¸¬è©¦
   - é‚Šç•Œæƒ…æ³æ¸¬è©¦
   - æ•ˆèƒ½å„ªåŒ–

## ğŸ”§ å¯¦ä½œç´°ç¯€

### å‰ç«¯çµ„ä»¶å¯¦ä½œ

#### MenuForm çµ„ä»¶
```typescript
const MenuForm: React.FC<MenuFormProps> = ({ 
  initialData, 
  onSubmit, 
  onCancel 
}) => {
  const [form] = Form.useForm();
  const [categories, setCategories] = useState<MenuCategory[]>([]);
  const [loading, setLoading] = useState(false);

  // è‡ªå‹•å–å¾—æœ€æ–°ç‰ˆæœ¬è™Ÿ
  useEffect(() => {
    fetchLatestVersion();
  }, []);

  const fetchLatestVersion = async () => {
    try {
      const response = await api.get('/api/v1/menu/latest-version');
      form.setFieldsValue({ version: response.version + 1 });
    } catch (error) {
      form.setFieldsValue({ version: 1 });
    }
  };

  // è™•ç†è¡¨å–®æäº¤
  const handleSubmit = async (values: any) => {
    setLoading(true);
    try {
      const menuData = {
        version: values.version,
        description: values.description,
        categories: categories
      };
      await onSubmit(menuData);
    } catch (error) {
      message.error('å»ºç«‹èœå–®å¤±æ•—');
    } finally {
      setLoading(false);
    }
  };

  return (
    <Form form={form} onFinish={handleSubmit} layout="vertical">
      <MenuBasicInfo />
      <CategoryList 
        categories={categories} 
        onChange={setCategories} 
      />
      <MenuPreview categories={categories} />
      <Form.Item>
        <Space>
          <Button type="primary" htmlType="submit" loading={loading}>
            å»ºç«‹èœå–®
          </Button>
          <Button onClick={onCancel}>å–æ¶ˆ</Button>
        </Space>
      </Form.Item>
    </Form>
  );
};
```

#### CategoryList çµ„ä»¶
```typescript
const CategoryList: React.FC<CategoryListProps> = ({ 
  categories, 
  onChange 
}) => {
  const addCategory = () => {
    const newCategory: MenuCategory = {
      name: '',
      items: []
    };
    onChange([...categories, newCategory]);
  };

  const updateCategory = (index: number, category: MenuCategory) => {
    const newCategories = [...categories];
    newCategories[index] = category;
    onChange(newCategories);
  };

  const removeCategory = (index: number) => {
    const newCategories = categories.filter((_, i) => i !== index);
    onChange(newCategories);
  };

  return (
    <div>
      {categories.map((category, index) => (
        <CategoryItem
          key={index}
          category={category}
          onChange={(updated) => updateCategory(index, updated)}
          onRemove={() => removeCategory(index)}
        />
      ))}
      <Button type="dashed" onClick={addCategory} block>
        æ–°å¢åˆ†é¡
      </Button>
    </div>
  );
};
```

### å¾Œç«¯ API å¯¦ä½œ

#### æ–°å¢å–å¾—æœ€æ–°ç‰ˆæœ¬è™Ÿç«¯é»
```csharp
[HttpGet("latest-version")]
public async Task<ActionResult<object>> GetLatestVersion()
{
    try
    {
        var latestMenu = await _context.Menus
            .OrderByDescending(m => m.Version)
            .FirstOrDefaultAsync();

        if (latestMenu == null)
        {
            return Ok(new { version = 0, lastUpdated = (DateTime?)null });
        }

        return Ok(new
        {
            version = latestMenu.Version,
            lastUpdated = latestMenu.LastUpdated
        });
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "å–å¾—æœ€æ–°ç‰ˆæœ¬è™Ÿæ™‚ç™¼ç”ŸéŒ¯èª¤");
        return StatusCode(500, new { message = "æœå‹™æš«æ™‚ä¸å¯ç”¨" });
    }
}
```

#### å„ªåŒ–èœå–®å»ºç«‹é©—è­‰
```csharp
[HttpPost]
[Authorize(Roles = "Admin")]
public async Task<ActionResult<object>> UpdateMenu([FromBody] CreateMenuRequest request)
{
    try
    {
        // é©—è­‰è¼¸å…¥
        if (request.Categories == null || !request.Categories.Any())
        {
            return BadRequest(new { message = "è‡³å°‘éœ€è¦ä¸€å€‹åˆ†é¡" });
        }

        // æª¢æŸ¥ SKU é‡è¤‡
        var allSkus = request.Categories
            .SelectMany(c => c.Items)
            .Select(i => i.Sku)
            .ToList();
        
        var duplicateSkus = allSkus
            .GroupBy(sku => sku)
            .Where(g => g.Count() > 1)
            .Select(g => g.Key)
            .ToList();

        if (duplicateSkus.Any())
        {
            return BadRequest(new { 
                message = $"SKU é‡è¤‡: {string.Join(", ", duplicateSkus)}" 
            });
        }

        // é©—è­‰å¿…å¡«æ¬„ä½
        foreach (var category in request.Categories)
        {
            if (string.IsNullOrWhiteSpace(category.Name))
            {
                return BadRequest(new { message = "åˆ†é¡åç¨±ä¸èƒ½ç‚ºç©º" });
            }

            foreach (var item in category.Items)
            {
                if (string.IsNullOrWhiteSpace(item.Sku))
                {
                    return BadRequest(new { message = "SKU ä¸èƒ½ç‚ºç©º" });
                }
                if (string.IsNullOrWhiteSpace(item.Name))
                {
                    return BadRequest(new { message = "é …ç›®åç¨±ä¸èƒ½ç‚ºç©º" });
                }
                if (item.Price <= 0)
                {
                    return BadRequest(new { message = "åƒ¹æ ¼å¿…é ˆå¤§æ–¼ 0" });
                }
            }
        }

        // å»ºç«‹æ–°èœå–®ç‰ˆæœ¬
        var newVersion = await GetNextVersion();
        var newMenu = new Menu
        {
            Version = newVersion,
            MenuData = JsonSerializer.Serialize(new { categories = request.Categories }),
            LastUpdated = DateTime.UtcNow
        };

        _context.Menus.Add(newMenu);
        await _context.SaveChangesAsync();

        return Ok(new
        {
            version = newVersion,
            lastUpdated = newMenu.LastUpdated,
            message = "èœå–®å»ºç«‹æˆåŠŸ"
        });
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "èœå–®å»ºç«‹éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤");
        return StatusCode(500, new { message = "èœå–®å»ºç«‹å¤±æ•—" });
    }
}

private async Task<int> GetNextVersion()
{
    var currentVersion = await _context.Menus
        .OrderByDescending(m => m.Version)
        .Select(m => m.Version)
        .FirstOrDefaultAsync();
    
    return currentVersion + 1;
}
```

## ğŸ§ª æ¸¬è©¦è¨ˆç•«

### å–®å…ƒæ¸¬è©¦
1. **å‰ç«¯çµ„ä»¶æ¸¬è©¦**
   - è¡¨å–®é©—è­‰é‚è¼¯
   - ç‹€æ…‹ç®¡ç†
   - äº‹ä»¶è™•ç†

2. **å¾Œç«¯ API æ¸¬è©¦**
   - è¼¸å…¥é©—è­‰
   - éŒ¯èª¤è™•ç†
   - è³‡æ–™åº«æ“ä½œ

### æ•´åˆæ¸¬è©¦
1. **ç«¯åˆ°ç«¯æ¸¬è©¦**
   - å®Œæ•´èœå–®å»ºç«‹æµç¨‹
   - æ¬Šé™é©—è­‰
   - éŒ¯èª¤è™•ç†

2. **æ•ˆèƒ½æ¸¬è©¦**
   - å¤§é‡è³‡æ–™è™•ç†
   - ä¸¦ç™¼è«‹æ±‚è™•ç†

### ä½¿ç”¨è€…æ¸¬è©¦
1. **æ˜“ç”¨æ€§æ¸¬è©¦**
   - æ–°ä½¿ç”¨è€…æ“ä½œæµç¨‹
   - éŒ¯èª¤æ¢å¾©èƒ½åŠ›
   - å­¸ç¿’æ›²ç·šè©•ä¼°

## ğŸ“Š æˆåŠŸæŒ‡æ¨™

### åŠŸèƒ½æŒ‡æ¨™
- [ ] ç‰ˆæœ¬è™Ÿè‡ªå‹•è¨ˆç®—æ­£ç¢º
- [ ] è¡¨å–®é©—è­‰å®Œæ•´
- [ ] é˜²å‘†æ©Ÿåˆ¶æœ‰æ•ˆ
- [ ] é è¦½åŠŸèƒ½æ­£å¸¸

### ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™
- [ ] å»ºç«‹èœå–®æ™‚é–“ < 2 åˆ†é˜
- [ ] éŒ¯èª¤ç‡ < 5%
- [ ] ä½¿ç”¨è€…æ»¿æ„åº¦ > 4.0/5.0

### æŠ€è¡“æŒ‡æ¨™
- [ ] API å›æ‡‰æ™‚é–“ < 500ms
- [ ] å‰ç«¯è¼‰å…¥æ™‚é–“ < 2s
- [ ] è¨˜æ†¶é«”ä½¿ç”¨é‡ç©©å®š

## ğŸš€ éƒ¨ç½²è¨ˆç•«

### é–‹ç™¼ç’°å¢ƒ
1. **å¾Œç«¯éƒ¨ç½²**
   - æ›´æ–° API ç«¯é»
   - åŸ·è¡Œè³‡æ–™åº« Migration
   - æ›´æ–° API æ–‡ä»¶

2. **å‰ç«¯éƒ¨ç½²**
   - å»ºç½®æ–°ç‰ˆæœ¬
   - æ›´æ–°è·¯ç”±é…ç½®
   - æ¸¬è©¦åŠŸèƒ½å®Œæ•´æ€§

### ç”Ÿç”¢ç’°å¢ƒ
1. **åˆ†éšæ®µéƒ¨ç½²**
   - å…ˆéƒ¨ç½²å¾Œç«¯ API
   - å†éƒ¨ç½²å‰ç«¯ä»‹é¢
   - ç›£æ§ç³»çµ±ç©©å®šæ€§

2. **å›æ»¾è¨ˆç•«**
   - æº–å‚™å›æ»¾è…³æœ¬
   - ç›£æ§é—œéµæŒ‡æ¨™
   - å¿«é€Ÿå›æ»¾æ©Ÿåˆ¶

## ğŸ“š æ–‡ä»¶æ›´æ–°

### æŠ€è¡“æ–‡ä»¶
- [ ] æ›´æ–° API æ–‡ä»¶
- [ ] æ›´æ–°å‰ç«¯çµ„ä»¶æ–‡ä»¶
- [ ] æ›´æ–°éƒ¨ç½²æ–‡ä»¶

### ä½¿ç”¨è€…æ–‡ä»¶
- [ ] æ›´æ–°æ“ä½œæ‰‹å†Š
- [ ] æ–°å¢åŠŸèƒ½èªªæ˜
- [ ] æ›´æ–°å¸¸è¦‹å•é¡Œ

## ğŸ”„ å¾ŒçºŒå„ªåŒ–

### çŸ­æœŸå„ªåŒ–
1. **æ•ˆèƒ½å„ªåŒ–**
   - å‰ç«¯çµ„ä»¶æ‡¶è¼‰å…¥
   - API å¿«å–æ©Ÿåˆ¶
   - è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–

2. **åŠŸèƒ½å¢å¼·**
   - èœå–®ç¯„æœ¬åŠŸèƒ½
   - æ‰¹æ¬¡åŒ¯å…¥åŠŸèƒ½
   - ç‰ˆæœ¬æ¯”è¼ƒåŠŸèƒ½

### é•·æœŸè¦åŠƒ
1. **é€²éšåŠŸèƒ½**
   - èœå–®æ’ç¨‹åŠŸèƒ½
   - å¤šèªè¨€æ”¯æ´
   - è¡Œå‹•ç«¯é©é…

2. **ç³»çµ±æ•´åˆ**
   - èˆ‡ POS ç³»çµ±æ•´åˆ
   - èˆ‡åº«å­˜ç³»çµ±æ•´åˆ
   - èˆ‡è²¡å‹™ç³»çµ±æ•´åˆ

---

**æ–‡ä»¶å»ºç«‹æ™‚é–“**: 2024å¹´12æœˆ  
**ç‰ˆæœ¬**: v1.0  
**è² è²¬äºº**: AI Assistant  
**ç‹€æ…‹**: è¦åŠƒä¸­ 