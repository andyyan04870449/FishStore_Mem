# 開發手冊

## 2025-07-12 更新

### 進度摘要
- 已完成第二階段「核心 API 開發」
- Device 與 Menu 資料表結構已調整，Migration 檔已產生
- 程式碼已通過建置，待資料庫啟動後執行 migration

### API 路由
- 認證：POST `/api/v1/auth`，傳入 `{ deviceCode }`，回傳 JWT Token
- 菜單查詢：GET `/api/v1/menu?version=4`，需 JWT 驗證
- 菜單更新：POST `/api/v1/menu`，需 Admin 權限
- 批次訂單上傳：POST `/api/v1/orders/bulk`，需 JWT 驗證
- 訂單查詢：GET `/api/v1/orders`，支援分頁與日期區間查詢

### JWT 驗證
- 需於 HTTP Header 加入 `Authorization: Bearer <token>`
- Token 由 `/api/v1/auth` 取得，有效期 20 小時
- 角色權限（如 Admin）需於 JWT Claim 設定

### 資料庫結構
- Device：新增 DeviceCode 欄位，唯一且必填
- Menu：改為版本化設計，內容以 JSON 儲存
- 其餘資料表（Order, OrderItem, User）結構不變

### 開發注意事項
- 需先啟動 PostgreSQL，並確認連線字串正確
- Migration 需於資料庫啟動後執行：`dotnet ef database update`
- API 測試建議使用 Postman 或 Swagger

--- 